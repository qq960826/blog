---
title: 'RoboMaster图像处理(二):通信协议篇'
url: 355.html
id: 355
comments: false
categories:
  - 图像识别
date: 2017-06-11 21:29:08
tags:
---

这篇文章主要涉及到了妙算(一款基于arm内核的嵌入式Linux电脑)与stm32之间的通信。
学过计算机网络的同学都应该知道OSI模型，参照OSI模型我设计协议的时候就只涉及四层，分别是物理层，数据链路层，协议层和应用层。 
首先是物理层，这里用的是串口，数据在物理层上是以数据流的形式进行传输的。
然后是数据链路层，这里数据链路层有如下两个作用。
1.将物理层上的数据流封装成帧。这里帧头为0xFE,帧伟为0xFF,如果在数据帧内部遇上这两种字节，则进行转义，即将0xfe替换成0xfe 0xfc将0xff替换成0xfe 0xfd。
2.差错控制功能。防止在传输过程中发送数据流的丢失，产生异常数据加入了CRC32校检。 数据帧的设计如下:
```c
/*
 * FE //帧头
 * 00 00 00 00//帧大小
 * 00 00 00 00//CRC32校检
 * ...........//数据
 * FF //帧尾
 */
```

再然后就是协议层，这里的通信采用的是谷歌开源的[Protocol Buffers](https://developers.google.com/protocol-buffers/),使用Protocol Buffers有如下好处: 
1.设计协议的时候，不用去考虑各个字节的作用，Protocol Buffers可以直接将你想传输的数据自动给序列化好 
2.Protocol Buffers的跨语言跨平台性能好，不仅可以用来在妙算(用cpp写的程序)与stm32(c写的程序)直接通信，还可以用来编写上位机程序(c#编写)
最后是应用层。即将协议层来的数据最后都对应到各个程序功能上去。